<!DOCTYPE html>
<!--[if lt IE 7 ]>
<html class="ie ltie7 ltie8 ltie9" lang="en"> <![endif]-->
<!--[if IE 7 ]>
<html class="ie ie7 ltie8 ltie9" lang="en"> <![endif]-->
<!--[if IE 8 ]>
<html class="ie ie8 ltie9" lang="en"> <![endif]-->
<!--[if IE 9 ]>
<html class="ie ie9 ltie10" lang="en"> <![endif]-->
<!--[if gt IE 9]> ><! <![endif]-->
<html lang='en'>
<!-- <![endif] -->
<head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='' name='keywords'>
    <meta content='' name='description'>
    <meta content='' name='author'>
    <meta content="authenticity_token" name="csrf-param"/>
    <meta content="AFj6NHY8vKIsJXJETPm56O/UCvnKQRsTHsiUIveDKJg=" name="csrf-token"/>
    <script src="/static/debugger_files/application-a237f6ba975152067b88e2b0aa2eb4c5.js"
            type="text/javascript"></script>
    <link href="/static/application-974b835d4cab4eed5e6134e3f82960f8.css" media="screen" rel="stylesheet"
          type="text/css"/>
    <title>Embedded Security CTF</title>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script> <![endif]-->
</head>
<body>
{% with level=level %}
    {% include 'partials/header.html' %}
{% endwith %}
<script src="/static/debugger_files/pagebody-df45cb0631518620834e9bb833418041.js" type="text/javascript"></script>
<script src="/static/debugger_files/guide-2cf611b7ffd734bbf045f1ea8c23da13.js" type="text/javascript"></script>
<link href="/static/debugger_files/debugger-2069d7cd3ced1a62004841545ae8342d.css" media="screen" rel="stylesheet"
      type="text/css"/>
<link href="/static/debugger_files/guideline-824f2f93d9fb439801534265711ae479.css" media="screen" rel="stylesheet"
      type="text/css"/>
<main id='main_content'>
    <div class='wrap'>
        <div class='column-2'>
            <div class='gold-box smaller'>
                <h2 class='h2hide'>Register State</h2>
                <code id='registers'>
                    <pre>pc  0000  sp  0000  sr  0000  cg  0000</pre>
                    <pre>r04 0000  r05 0000  r06 0000  r07 0000</pre>
                    <pre>r08 0000  r09 0000  r10 0000  r11 0000</pre>
                    <pre>r12 0000  r13 0000  r14 0000  r15 0000</pre>
                </code>
            </div>
            <div class='gold-box smaller2'>
                <h2 class='h2hide'>Current Instruction</h2>
                <code id='memorywatch'>
                    <pre id='insnbytes'></pre>
                    <pre><br></pre>
                    <pre id='insndecoded'></pre>
                    <pre><br></pre>
                </code>
            </div>
            <div style='clear: both'></div>
            <div class='teal-box'>
                <h2 class='h2hide'>Debugger Console</h2>
                <code>
                    <div class='replresponsesouter'>
                        <pre id='responses'></pre>
                    </div>
                </code>
                <div class='textentrywrap'>
                    <input autocomplete='false' autofocus='autofocus' class='textentry' id='textentry'
                           spellcheck='false'>
                </div>
            </div>
            <div class='teal-box'>
                <h2 class='h2hide'>I/O Console</h2>
                <code class='ioresponsesouter'>
                    <pre id='ioresponses'></pre>
                </code>
            </div>
        </div>
        <div class='column-1'>
            <div class='teal-box' id='asmboxwrap'>
                <h2 class='h2hide'>Disassembly</h2>
                {{ disassembly }}
            </div>
            <div class='gold-box'>
                <h2 class='h2hide'>Live Memory Dump</h2>
                <code class='memorybox' id='memorybox'>
                    <div class='watchline' id='r00line' style='display: none'></div>
                    <div class='watchline' id='r01line' style='display: none'></div>
                    <div class='watchline' id='r04line' style='display: none'></div>
                    <div class='watchline' id='r05line' style='display: none'></div>
                    <div class='watchline' id='r06line' style='display: none'></div>
                    <div class='watchline' id='r07line' style='display: none'></div>
                    <div class='watchline' id='r08line' style='display: none'></div>
                    <div class='watchline' id='r09line' style='display: none'></div>
                    <div class='watchline' id='r10line' style='display: none'></div>
                    <div class='watchline' id='r11line' style='display: none'></div>
                    <div class='watchline' id='r12line' style='display: none'></div>
                    <div class='watchline' id='r13line' style='display: none'></div>
                    <div class='watchline' id='r14line' style='display: none'></div>
                    <div class='watchline' id='r15line' style='display: none'></div>
                    <span class='watchbox' id='r00name' style='display: none'>pc</span>
                    <span class='watchbox' id='r01name' style='display: none'>sp</span>
                    <span class='watchbox' id='r04name' style='display: none'>r04</span>
                    <span class='watchbox' id='r05name' style='display: none'>r05</span>
                    <span class='watchbox' id='r06name' style='display: none'>r06</span>
                    <span class='watchbox' id='r07name' style='display: none'>r07</span>
                    <span class='watchbox' id='r08name' style='display: none'>r08</span>
                    <span class='watchbox' id='r09name' style='display: none'>r09</span>
                    <span class='watchbox' id='r10name' style='display: none'>r10</span>
                    <span class='watchbox' id='r11name' style='display: none'>r11</span>
                    <span class='watchbox' id='r12name' style='display: none'>r12</span>
                    <span class='watchbox' id='r13name' style='display: none'>r13</span>
                    <span class='watchbox' id='r14name' style='display: none'>r14</span>
                    <span class='watchbox' id='r15name' style='display: none'>r15</span></code>
            </div>
            <div style='clear: both'></div>
        </div>
        <a class='button orange' href='#hideheaders' id='hideheaders' onclick='hideheaders()'>Toggle minimal mode</a>
        <a class='button orange' id='download-rom' href='/rom' download style="margin-left: 10px">Download ROM file</a>
    </div>
</main>
<div id='gray_bg' style='display: none'>
    <div id='real_bg'></div>
    <div class='myalert_outer' id='io_outer' style='display: none'>
        <div class='myalert_inner' id='io_inner'>
            <div class='gold-box'>
                <h2>IO interrupt triggered</h2>
                <div class='spaceborder'>
                    <br>
                    The CPU has requested user input from the console. Below is the output
                    displayed on the console.
                    <div id='io_output_box_wrap'>
                        <div id='io_output_box'>
                            <pre class='wrap'>&nbsp;</pre>
                        </div>
                    </div>
                    Enter input below:
                    <div>
                        <input id='io_check_box' type='checkbox'>
                        <label for='io_check_box'>
                            Check here if entering hex encoded input.
                        </label>
                    </div>
                    <div>
                        <input autocomplete='false' id='io_input_box' spellcheck='false'>
                        <input class='button orange' onclick='cpu.io_response()' type='button' value='send'>
                        <input class='button grey' id='io_wait' onclick='cpu.io_wait()' type='button' value='wait'>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class='myalert_outer' id='youwin_outer' style='display: none'>
        <div class='myalert_inner' id='youwin_inner'>
            <div class='gold-box'>
                <h2>Door Unlocked</h2>
                <div class='spaceborder'>
                    <center id='youwintext'>.</center>
                    <center>
                        <input class='button orange' id='nextlevelbutton' type='button' value="let's go!">
                    </center>
                </div>
            </div>
        </div>
    </div>
    <div class='myalert_outer' id='nowin_outer' style='display: none'>
        <div class='myalert_inner' id='nowin_inner'>
            <div class='gold-box'>
                <h2>Not Accepted</h2>
                <div class='spaceborder'>
                    The lock did not accept your input. Try again.
                    <center>
                        <input class='button orange' onclick='endnowin()' type='button' value='okay'>
                    </center>
                </div>
            </div>
        </div>
    </div>
    <div class='myalert_outer' id='info_outer' style='display: none'>
        <div class='myalert_inner' id='info_inner'>
            <div class='gold-box'>
                <h2>Manual</h2>
                <div class='spaceborder'>
                    <pre id='info' style='padding: 10px'></pre>
                    <center>
                        <input class='button orange' onclick='donemanual()' type='button' value='okay'>
                    </center>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script>
    String.prototype.last = function (n) {
        if (n > this.length)
            return this;
        else {
            return this.substring(this.length, this.length - n);
        }
    };

    var csrf_param = $("meta[name=csrf-param]").attr('content');
    var csrf_value = $("meta[name=csrf-token]").attr('content');

    $(function () {
        $("form.real").each(function () {
            $("<input>").attr("type", "HIDDEN").attr("name", csrf_param).val(csrf_value).appendTo($(this));
        });

        $(".close").click(function () {
            $(this).closest(".alert").remove()
        });
    });

    $.ajaxSetup({
        beforeSend: function (xhr) {
            xhr.setRequestHeader('X-CSRF-Token',
                $('meta[name="csrf-token"]').attr('content'));
        }
    });
</script>
